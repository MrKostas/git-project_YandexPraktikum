# Учебный проект 7_Обучение с учителем: качество модели

На исследовании находятся данные `поведении покупателей на сайте интернет-магазина, выручке магазина с одного покупателя, времени посещения покупателями сайта интернет-магазина и таблица с данными о среднемесячной прибыли продавца за последние 3 месяца`, которые были предоставлены руководством компании "В один клик".

---

`Задача`

**Разработать модели машинного обучения для персонализации предложений постоянным клиентам магазина**:

---

`Путь решения`

1. Промаркировать уровень финансовой активности постоянных покупателей: `снизилась` - если клиент стал покупать меньше товаров; `прежний уровень`;
2. Собрать данные по клиентам по следующим группам:
    * Признаки, которые описывают коммуникацию сотрудников компании с клиентом;
    * Признаки, которые описывают продуктовое поведение покупателя;
    * Признаки, которые описывают покупательское поведение клиента;
    * Признаки, которые описывают поведение покупателя на сайте.
3. Построить модель, которая `предскажет вероятность снижения покупательской активности клиента в следующие 3 месяца`;
4. Провести исследование прибыльности клиента - `какой доход каждый покупатель приносил компании за последние 3 месяца`;
5. Выделить сегменты покупателей и разработать для них персонализированные предложения.

---

`Располагаемые данные`

**Поведение покупателя на сайте - market_file**

* id - номер покупателя в корпоративной базе данных;
* Покупательская активность — рассчитанный класс покупательской активности (целевой признак): `снизилась` или `прежний уровень`;
* Тип сервиса — уровень сервиса, например `премиум` и `стандарт`;
* Разрешить сообщать — информация о том, можно ли присылать покупателю дополнительные предложения о товаре. Согласие на это даёт покупатель;
* Маркет_актив_6_мес — среднемесячное значение маркетинговых коммуникаций компании, которое приходилось на покупателя за последние 6 месяцев. Это значение показывает, какое число рассылок, звонков, показов рекламы и прочего приходилось на клиента;
* Маркет_актив_тек_мес — количество маркетинговых коммуникаций в текущем месяце;
* Длительность — значение, которое показывает, сколько дней прошло с момента регистрации покупателя на сайте;
* Акционные_покупки — среднемесячная доля покупок по акции от общего числа покупок за последние 6 месяцев;
* Популярная_категория — самая популярная категория товаров у покупателя за последние 6 месяцев;
* Средний_просмотр_категорий_за_визит — показывает, сколько в среднем категорий покупатель просмотрел за визит в течение последнего месяца;
* Неоплаченные_продукты_штук_квартал — общее число неоплаченных товаров в корзине за последние 3 месяца;
* Ошибка_сервиса — число сбоев, которые коснулись покупателя во время посещения сайта;
* Страниц_за_визит - среднее количество страниц, которые просмотрел покупатель за один визит на сайт за последние 3 месяца.

**Данные о выручке с покупателя - market_money**

* id — номер покупателя в корпоративной базе данных;
* Период — название периода, во время которого зафиксирована выручка. Например, `текущий_месяц` или `предыдущий_месяц`;
* Выручка - сумма выручки за период.

**Данные о времени, которое покупатель провел на сайте - market_time**

* id — номер покупателя в корпоративной базе данных;
* Период — название периода, во время которого зафиксировано общее время;
* минут — значение времени, проведённого на сайте, в минутах.

**Данные о среднемесячной прибыли продавца за последние 3 месяца - money**

* id - номер покупателя в корпоративной базе данных;
* Прибыль - значение прибыли.

## Результаты работы над проектом

1. Произведен выбор оптимальной модели из набора С перебором параметров и поиском по сетке - **GridSearchCV**. Лучшая модель и ее параметры:
    * **SVC**;
    * **probability = True**;
    * **random_state = 42**;
    * **Механизм масштабирования количественных значений - StandardScaler()**.
2. Построена матрица ошибок для оценки эффективности модели:
    * Значения TP - 95;
    * Значения TN - 196;
    * Значения FP - 5;
    * Значения FN - 29;
    * Всего значений в выборке - 325.
3. Произведена оценка качества работы модели SVC на тестовой выборке:
    * Precision - 0.95;
    * Recall - 0.77;
    * FBeta_score - 0.81
4. Проведено кодирование / масштабирование значений исходной обучающей выборки - инициализирована переменная **X_enc**;
5. Обучена лучшая модель на наборе **X_enc** и сохранена в отдельную переменную **best_estim**;
6. Проведен поиск и визуализация степени влияния признаков на результаты работы модели - использована библиотека **SHAP**.

Менее всего на значение целевой переменной оказывают влияние признаки:
* **popular_category** - популярная категория товаров;
* **allow_notifications** - разрешить уведомления.

Остальные признаки имеют примерно схожую степень влияния - они могут быть использованы для дальнейшей сегментации пользователей. 

7. Построены диаграммы рассеяния в зависимости от выбранного количественного показателя и вероятности принадлежности к классу 1;
8. Произведена сегментация пользователей:

На основании построенной визуализации можно выделить следующие паттерны в количественных показателях, которые характеризуют пользователей со сниженной активностью:

* **market_activity_6 months** - менее 4 месяцев;
* **discount_purchases** - наблюдаются 2 группы:
    * у пользователей снижается активность, и они **имеют низкие доли акциоанных покупок**;
    * у пользователей снижается активность, и они **совершают только покупки по акции** (> 0.6). Эта группа более показательна. Можно сказать, что данные пользователи заходят на ресурс только при наличии выгодных предложений. Покупки вне акционных периодов их не интересуют.
* **average_category_views** - менее 3;
* **pages_per_visit** - менее 7;
* **minutes_previous** и **minutes_current** - менее 13;
* **revenue_total** - более 10 000.
9. Построены гистограммы распределения количественных величин для отобранных пользователей;
10. Построениы диграмм для качественных показателей для отобранных пользователей:
    
Можно отметить следующие отличительные особенности пользователей, совершающих покупки по акции:
* Эти пользователи точно знаю, чего хотят - **количество просмотренных страниц и изученных категорий обычно составляет 2 или 3**;
* В большинстве своем эти пользователи подписаны на рассылку оповещений - **как только появляется новость об акционных товаров, они переходят на сайт магазина**;
* Основные категории трат пользователей - **это детские товары и домашний текстиль**;
* Тип сервиса у таких пользователей - **стандарт**;

Для предотвращения снижения покупательской активности у выделенной когорты пользователей можно предпринять следующие действия:
1. Предложить промокоды на переход в "премиумный" сервис. В таком ключе удастся поддержать стабильные траты пользователей: предлагаемые товары в категориях будут идти со скидкой, а сам пользователь будет так же платить за подписку. При сведении итогового баланса в плюсе окажется магазин;
2. Предлагать увеличенную скидку на покупку комплекта. Помимо покупки товара из категории можно предложить пользователям купить что-то смежное, что дополнит первоначальную покупку;
3. Сформировать систему рекомендаций товаров, чтобы пользователи, перешедшие по ссылке на сайт магазина, видели на стартовой странице другие товары со скидкой, которые могут потенциально им подойти.